from garden_api import create_app
import json
from test_unitaire.Tools import TestGeneric

class ExploitantTest(TestGeneric):

    def test_nb_exploitant(self):
        client = self.app.test_client()
        rv = client.get('/exploitant/nombre/')
        print(rv.json)
        self.assertEqual(rv.status_code, 200)
        self.assertEqual(rv.json, [[10]], "le nombre d'exploitant n'est pas le bon")  # assertEqual() same as expect() in vue js

    def test_exploitant_get(self):
        client = self.app.test_client()
        rv = client.get('/exploitant/') # We test the route
        #print(rv.json)
        self.assertEqual(len(rv.json), 10, "le nombre d'exploitant dans la liste n'est pas le bon") 
        string_response = json.dumps(rv.json)
        print(string_response)
        self.assertIn('Kosmos', string_response, "l'exploitant n'est pas présent dans la liste") 

    def test_exploitant_add(self):
        client = self.app.test_client()
        data1 = {'lib_exploitant_long': 'exploitant test 2 long', 'lib_exploitant_court': 'exploitant test 2 court', 'role': '0', 'etat': '1'}
        response = client.post('/exploitant/', data=json.dumps(data1), headers={'Content-Type': 'application/json'})
        print(response.json)
        self.assertEqual(response.json, "L'exploitant/éditeur exploitant test 2 long a bien été ajouté")

    def test_exploitant_edit(self):
        client = self.app.test_client()
        data2 = {'lib_exploitant_long': 'Kosmos', 'lib_exploitant_court': 'Kosmos test', 'etat': '1', 'role': '0'}
        response = client.put('/exploitant/5', data=json.dumps(data2), headers={'Content-Type': 'application/json'})
        print(response.json)
        self.assertEqual(response.status_code, 200)
        self.assertEqual(response.json, {'id_exploitant': 5, 'lib_exploitant_long': 'Kosmos', 'lib_exploitant_court': 'Kosmos test', 'etat': 1, 'role': 0}, 'l\'exploitant a été modifié')
        
    
    