from flask_restful import Resource, fields, marshal as flask_marshall
from http import HTTPStatus
from garden_api.models import db, ExploitantRole as ExploitantRoleEntity


def marshal(entity: ExploitantRoleEntity):
    resource_fields = {
        "role": fields.Integer(attribute="role"),
        "libelle": fields.String(attribute="libelle_role")}
    return flask_marshall(entity, resource_fields)


class ExploitantRole(Resource):
    # GET all the exploitant roles

	def get(self):
		try:
			role_request = db.session.query(ExploitantRoleEntity)
			response_data = []
			for role_item in role_request:
				response_data.append(marshal(role_item))
			return response_data

		except Exception as e:
			print(e)
			return None, HTTPStatus.INTERNAL_SERVER_ERROR

        
		